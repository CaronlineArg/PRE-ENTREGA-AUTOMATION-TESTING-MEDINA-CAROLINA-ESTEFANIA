name: CI de Pruebas (Rama Específica)

on: 
  push:
    branches: 
      - proyecto-final-automation-testing-carolina-medina

jobs:
  run-tests:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout del repositorio
      - name: Checkout del Repositorio
        uses: actions/checkout@v4

      # 2️⃣ Instalar Microsoft Edge
      - name: Instalar Microsoft Edge
        run: |
          sudo apt-get update
          sudo apt-get install -y wget apt-transport-https ca-certificates curl gnupg
          curl -sL https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor | sudo tee /usr/share/keyrings/microsoft-edge.gpg > /dev/null
          echo "deb [arch=amd64 signed-by=/usr/share/keyrings/microsoft-edge.gpg] https://packages.microsoft.com/repos/edge stable main" | sudo tee /etc/apt/sources.list.d/microsoft-edge.list
          sudo apt-get update
          sudo apt-get install -y microsoft-edge-stable

      # 3️⃣ Configurar Python 3.x
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      # 4️⃣ Instalar dependencias
      - name: Instalar Dependencias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 5️⃣ Ejecutar pruebas con pytest y generar reporte HTML
      - name: Ejecutar Pruebas
        run: |
          mkdir -p reports
          # pytest genera reporte HTML; usamos '|| true' para que el job no falle si hay tests fallidos
          pytest -s --html=reports/reporte.html || true

      # 6️⃣ Subir reporte HTML como artefacto
      - name: Subir reportes
        uses: actions/upload-artifact@v4
        with:
          name: reports
          path: reports/
